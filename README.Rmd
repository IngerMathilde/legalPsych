---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  width = 100
)
options(width=100)

```

# legalPsych
The legalPsych package consists of tools commonly used in the legal psychology area. Currently, all the tools are related to the analysis of the confidence-accuracy relationship. However, future updates might include additional tools, such as fairness testing.   

With the current functions you can create curves for calibration and confidence accuracy characteristics tests. It is also possible to calculate and compare the C, O/U, and NRI calibration statistics. 

**Note:** This is beta software. Bugs are possible, both in terms of programming errors and computation errors.

## Getting Started
The legalPsych package that works on the R platform. 

### Instalation
The legalPsych package is currently not available through CRAN and it needs to be installed through Github. To do this you have to install `devtools` if you haven't already.

```r 
install.packages("devtools")
```

To install or update legalPsych package write the following.  
```r
devtools::install_github("IngerMathilde/legalPsych")
```
**Note**: Make sure to detach the legalPsych package or restart R prior to updating.

### Dependencies
For the legalPsych package to work, you will need to load the legalPsych, ggplot2 and jtools package.

```{r message=FALSE}
library(legalPsych)
library(ggplot2)
library(jtools)
```

### Dataset prerequisites
For the legalPsych functions to work, your dataset needs to adhere to the following prerequisites.   

* Your dataset needs to include at least one variable indicating identification confidence.  
* Your dataset needs to include one variable indicating identification accuracy. Identification accuracy needs to be a binary variable where 0 indicates an incorrect and 1 indicates a correct identification.  
* In case of multiple identifications per person, you need to transfer your dataset to a long format. 

You can check the `metamemoryCA` dataset for an example of a correct dataset. 
```{r}
data(metamemoryCA)
```

## Usage
Here are some examples regarding the functionality of the functions in the package. These examples use the `data(metamemoryCA)` example dataset. 

### EXAMPLE 1: Calibration for the whole dataset
Create calibration curves and statistics (overall and for each level) for the whole dataset
```{r EX1 CA.rel}
All <- CA.rel(data = metamemoryCA, confidence = "Confidence", correct = "ChoiceCorrect", test = "CAL", 
              confidenceLevels = c(0,10,20,30,40,50,60,70,80,90,100))
```

Print a table for each level of confidence that includes proportion correct, diagnostic variable and more. It also states the C, OU, and NRI statistic.
```{r EX1 CA.print, width = 100}
CA.print(All)
```

Print the calibration curve, but don't show the legend. Also change the y axis label to have breaks for every 10% of confidence
```{r EX1 CA.curves, echo=T,results='hide',fig.keep='all', out.width="70%"}
CA.curves(All, legend.position = "none",  ybreaks = c(0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100)) 
```
 

### EXAMPLE 2: Compare choosers vs. nonchoosers with collapsed confidence groups and Jackknife SE. 
To compare calibration scores for choosers vs. nonchoosers, the `var` variable to the `CA.rel()` function needs to be defined to "ChoiceChooser". "ChoiceChooser" is the variable in the data set that defines whether or not someone is a chooser.

In order to collapse certain confidence levels (e.g., group together the 0, 10, 20 confidence levels), the `confidenceLevels` argument needs to be defined as a list (e.g., `confidenceLevels = list(c(0,20),c(30,40), c(50,60), c(70,80), c(90,100)`). 

To attain jackknife SE for the C, OU, NRI statistic,`jack = T` is added to the `CA.rel()` function.
```{r EX2 CA.rel}
Choosers <- CA.rel(data = metamemoryCA, confidence = "Confidence", correct = "ChoiceCorrect", 
                   test = "CAL", var = "ChoiceChooser", 
                   confidenceLevels = list(c(0,20),c(30,40), c(50,60), c(70,80), c(90,100)), jack = T)
```
Create calibration curves to compare choosers to nonchoosers for all the different confidence levels. 
```{r EX2 CA.curves, echo=T,results='hide',fig.keep='all'}
CA.curves(Choosers)
```

Create an overview table of the C, OU and NRI statistic, with 95% CI between brackets
```{r EX2 CA.table}
CA.table(Choosers) 
```

### EXAMPLE 3: Calibration plot when disregarding lower confidence groups
When disregarding lower levels of confidence in the `confidenceLevel` variable, it is important to define the minimum attainable confidence level in the `ConfMin` variable to ensure that the calibration calculations are still accurate. See the difference between `Choosers.no.low.right` and `Choosers.no.low.wrong` calibration tables
```{r EX3 CA.rel, width = 100}
Choosers.no.low.right <- CA.rel(data = metamemoryCA, confidence = "Confidence", 
                                correct = "ChoiceCorrect", test = "CAL", var = "ChoiceChooser", 
                                confidenceLevels = list(c(50,60), c(70,80), c(90,100)), 
                                jack = T, confMin = 0)

Choosers.no.low.wrong <- CA.rel(data = metamemoryCA, confidence = "Confidence", 
                                correct = "ChoiceCorrect", test = "CAL", var = "ChoiceChooser", 
                                confidenceLevels = list(c(50,60), c(70,80), c(90,100)), jack = T)

```

Correctly calculated calibration table
```{r EX3 CA.table right, width = 100}
CA.table(Choosers.no.low.right)
```

Incorrectly calculated calibration table
```{r EX3 CA.table wrong, width = 100}
CA.table(Choosers.no.low.wrong)
```


### EXAMPLE 4: Compare high vs. low metamemory raters for choosers with adjusted variable names for output
To compare metamemory performance for choosers only it is important to first create a subset of the dataset that only includes choosers
```{r EX4 dataset}
data.ch <- subset(metamemoryCA, ChoiceChooser == "Chooser")
```

To compare multiple metamemory components simultaneously, the variable names of the metamemory components need to be defined as a vector in the `var` variable. The `var.level` argument makes it possible to compare high with low metamemory raters, while disregarding medium raters. Also to change the dataset variable names (e.g., `Rater.EMS.Eyewitness.Ability` to a name that is more "plot-friendly" (e.g., `EMS Eyewitness Ability`), you can declare new names through the `var.name` argument.
```{r EX4 CA.rel}
ch.raters <- CA.rel(data = data.ch, confidence = "Confidence", correct = "ChoiceCorrect", test = "CAL", 
                    var = c("Rater.EMS.Relative.Face.Recognition", "Rater.EMS.Eyewitness.Ability"), 
                    var.names = c("EMS Relative Face Recognition", "EMS Eyewitness Ability"), 
                    var.levels = c('Low', 'High'), 
                    confidenceLevels = list(c(0,20),c(30,40), c(50,60), c(70,80), c(90,100)), jack = T)
```

Create calibration plots which includes the variable names in the legend
```{r EX4 CA.curves, echo=T,results='hide',fig.keep='all'}
CA.curves(ch.raters, labelVarType = T)
```

Create a calibrations statistics table
```{r EX4 CA.table, width = 100}
CA.table(ch.raters)
```

Create a 95% CI plot for the calibration statistics to make it easier to inspect overlapping CI
```{r EX4 CA.plotCI, echo=T,results='hide',fig.keep='all'}
CA.plotCI(ch.raters)
```

### EXAMPLE 5: CAC curves
To create CAC curves, the data-frame needs to be subsetted to only include suspect identifications.
```{r EX5 dataset}
data.CAC <- subset(metamemoryCA, ChoiceValue == "Target")
```

For the `CA.rel()` function, it is important to declare the `test` variable to `test = "CAC"`.

```{r EX5 CA.rel}
CAC.raters <- CA.rel(data = data.CAC, confidence = "Confidence", correct = "ChoiceCorrect", test = "CAC", 
                     var = c("Rater.EMS.Relative.Face.Recognition", "Rater.EMS.Eyewitness.Ability"), 
                     var.names = c("EMS Relative Face Recognition", "EMS Eyewitness Ability"), 
                     var.levels = c('Low', 'High'), 
                     confidenceLevels = list(c(0,60), c(70,80), c(90,100)))
```

Plot CAC curves that include the variable name in the legend and where the legend is positioned in the right bottom corner. The error bars of the CAC are the 95% confidence intervals
```{r EX5 CA.curves, echo=T,results='hide',fig.keep='all'}
CA.curves(CAC.raters, labelVarType = T, legend.position = c(1,0), ybreaks = seq(50, 100, 10)) 
```

## Author
Inger van Boeijen

## Licence
This package is licensed under the The GNU General Public License v3.0 - see the [LICENSE](LICENSE) file for details

## Acknowledgments
I would like to thank Renan Saraiva for his support in creating this package
